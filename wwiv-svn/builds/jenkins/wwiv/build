#!/bin/bash
#
# WWIV 5.0 Build Script.
#
# Required Variables:
# WORKSPACE - wwiv-svn root directory
# BUILD_NUMBER - Jenkins Build number
# SVN_REVISION - subversion build number


rm ${WORKSPACE}/wwiv-build-linux-*.zip

set -e

declare -r RELEASE_ZIP=${WORKSPACE}/wwiv-build-linux-${SVN_REVISION}-${BUILD_NUMBER}.zip
cmake .
make -j12 
echo "RELEASE_ZIP: ${RELEASE_ZIP}"

if [[ ! -d "${WORKSPACE}/archives" ]]; then
  mkdir -p "${WORKSPACE}/archives"
  echo "Created archive dir: ${WORKSPACE}/archives"
fi

if [[ ! -d "${WORKSPACE}/release" ]]; then
  mkdir -p "${WORKSPACE}/release"
  echo "Created release dir: ${WORKSPACE}/release"
fi

echo "Creating Menus"
cd ${WORKSPACE}/bbs/admin/menus/en
zip -r ${WORKSPACE}/release/en-menus.zip *

echo "Creating zip-city"
cd ${WORKSPACE}/bbs/admin
zip -r ${WORKSPACE}/release/zip-city.zip zip-city/*

echo "Creating regions"
cd ${WORKSPACE}/bbs/admin
zip -r ${WORKSPACE}/release/regions.zip regions/*

echo "Creating release archive: ${RELEASE_ZIP}"
cd ${WORKSPACE}/release
zip ${RELEASE_ZIP} *

